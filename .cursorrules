# Dese EA Plan v5.0 - Cursor AI Rules

> **GeÃ§erlilik:** Bu kurallar Dese EA Plan v5.0 projesi iÃ§in geÃ§erlidir  
> **Versiyon:** 5.0.0  
> **Son GÃ¼ncelleme:** 2025-01-27  
> **Uyumluluk:** Cursor AI v2.0+, TypeScript 5.3+, Node.js 20.19+

---

## ğŸ¯ Proje Ã–zeti

Dese EA Plan v5.0 - CPT Optimization Domain iÃ§in Kubernetes + GitOps + AIOps uyumlu kurumsal planlama sistemi.

**Tech Stack:**
- **Frontend**: React 18 + TypeScript + Vite + Tailwind CSS
- **Backend**: Node.js + Express + PostgreSQL (Drizzle ORM)
- **Testing**: Vitest + Supertest + Playwright
- **Package Manager**: pnpm 8.15.0
- **Infrastructure**: Docker + Kubernetes + Helm
- **Monitoring**: Prometheus + Grafana + Loki + Tempo

---

## ğŸ¤– AI AsistanÄ± iÃ§in Ã–zel Direktifler

> **Ã–NEMLÄ°:** Cursor AI asistanÄ± kod Ã¶nerirken ve Ã¼retirken **MUTLAKA** aÅŸaÄŸÄ±daki kurallara uymalÄ±dÄ±r:

### Zorunlu Kurallar

1. **Path Aliases**: **HER ZAMAN** `@/` prefix'ini kullanÄ±n
   - âœ… `import { config } from '@/config/index.js'`
   - âŒ `import { config } from '../../config/index.js'`

2. **Type Safety**: **ASLA** `any` tipi Ã¶nermeyin
   - âœ… `function getUser(id: string): Promise<User | null>`
   - âŒ `function getUser(id: any)`

3. **Logging**: **ASLA** `console.log` Ã¶nermeyin, **HER ZAMAN** `logger` kullanÄ±n
   - âœ… `logger.info('User created', { userId: user.id })`
   - âŒ `console.log('User created:', user)`

4. **Error Handling**: **HER async fonksiyonda** try-catch kullanÄ±n
   - âœ… Always wrap async operations in try-catch
   - âŒ Never leave promises unhandled

5. **Database Queries**: **ASLA** raw SQL Ã¶nermeyin, **HER ZAMAN** Drizzle ORM kullanÄ±n
   - âœ… `db.query.users.findFirst({ where: eq(users.id, id) })`
   - âŒ `db.query('SELECT * FROM users WHERE id = ?')`

### Dosya YapÄ±sÄ± KurallarÄ±

AI asistanÄ± yeni dosya oluÅŸtururken ÅŸu yapÄ±yÄ± izlemelidir:

- `src/routes/**/*.ts` â†’ Route handlers (Express Router)
- `src/services/**/*.ts` â†’ Business logic
- `src/middleware/**/*.ts` â†’ Express middleware
- `src/db/**/*.ts` â†’ Database schema & connection
- `src/utils/**/*.ts` â†’ Utility functions
- `src/schemas/**/*.ts` â†’ Zod validation schemas

---

## ğŸ“ Dosya/Glob BazlÄ± Kurallar

### `src/routes/**/*.ts`

```typescript
// âœ… DoÄŸru Route YapÄ±sÄ±
import { Router } from 'express';
import { z } from 'zod';
import { logger } from '@/utils/logger.js';
import { exampleService } from '@/services/exampleService.js';
import { errorHandler } from '@/middleware/errorHandler.js';

const router = Router();

const createSchema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
});

router.post('/', async (req, res, next) => {
  try {
    const validated = createSchema.parse(req.body);
    const result = await exampleService.create(validated);
    logger.info('Resource created', { id: result.id });
    res.status(201).json(result);
  } catch (error) {
    next(error);
  }
});

export { router as exampleRoutes };
```

**Kurallar:**
- âœ… Router export edilmeli
- âœ… Zod validation ÅŸemasÄ± tanÄ±mlÄ±
- âœ… Service katmanÄ± kullanÄ±lmalÄ± (direct DB access âŒ)
- âœ… Swagger annotations eklenmeli
- âœ… Error handling middleware'e gÃ¶nderilmeli

### `src/services/**/*.ts`

```typescript
// âœ… DoÄŸru Service YapÄ±sÄ±
import { db } from '@/db/index.js';
import { users } from '@/db/schema.js';
import { eq } from 'drizzle-orm';
import { logger } from '@/utils/logger.js';

export const userService = {
  async findById(id: string): Promise<User | null> {
    try {
      const user = await db.query.users.findFirst({
        where: eq(users.id, id),
      });
      return user ?? null;
    } catch (error) {
      logger.error('Failed to find user', { id, error });
      throw error;
    }
  },
};
```

**Kurallar:**
- âœ… Business logic burada olmalÄ±
- âœ… Drizzle ORM kullanÄ±lmalÄ±
- âœ… Error handling ve logging zorunlu
- âœ… Type safety saÄŸlanmalÄ±

### `src/middleware/**/*.ts`

```typescript
// âœ… DoÄŸru Middleware YapÄ±sÄ±
import { Request, Response, NextFunction } from 'express';
import { logger } from '@/utils/logger.js';

export function customMiddleware(
  req: Request,
  res: Response,
  next: NextFunction
): void {
  try {
    // Middleware logic
    logger.debug('Middleware executed', { path: req.path });
    next();
  } catch (error) {
    logger.error('Middleware error', { error });
    next(error);
  }
}
```

**Kurallar:**
- âœ… Standard Express middleware signature
- âœ… Error handling zorunlu
- âœ… Logging eklenmeli

### `src/db/**/*.ts`

```typescript
// âœ… DoÄŸru Schema YapÄ±sÄ±
import { pgTable, uuid, varchar, timestamp } from 'drizzle-orm/pg-core';

export const users = pgTable('users', {
  id: uuid('id').primaryKey().defaultRandom(),
  email: varchar('email', { length: 255 }).notNull().unique(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
});
```

**Kurallar:**
- âœ… Drizzle ORM schema syntax kullanÄ±lmalÄ±
- âœ… Indexes ve constraints tanÄ±mlanmalÄ±
- âœ… Relations doÄŸru kurulmalÄ±

---

## ğŸ¨ Frontend KurallarÄ± (React + TypeScript + Vite)

### Component YapÄ±sÄ±

```typescript
// âœ… DoÄŸru Component YapÄ±sÄ±
import { FC } from 'react';

interface UserCardProps {
  id: string;
  name: string;
  email: string;
  onEdit?: (id: string) => void;
}

export const UserCard: FC<UserCardProps> = ({ id, name, email, onEdit }) => {
  return (
    <div className="p-4 bg-white rounded-lg shadow">
      <h3 className="text-lg font-semibold">{name}</h3>
      <p className="text-gray-600">{email}</p>
      {onEdit && (
        <button onClick={() => onEdit(id)}>Edit</button>
      )}
    </div>
  );
};
```

**Kurallar:**
- âœ… TypeScript interface kullanÄ±lmalÄ± (props iÃ§in)
- âœ… Functional components tercih edilmeli
- âœ… Tailwind CSS class'larÄ± kullanÄ±lmalÄ±
- âœ… Props optional ise `?` ile iÅŸaretlenmeli

---

## ğŸ”§ Backend KurallarÄ± (Node.js + Express)

### API Endpoint YapÄ±sÄ±

```typescript
// âœ… DoÄŸru Endpoint YapÄ±sÄ±
import { Router } from 'express';
import { z } from 'zod';
import { logger } from '@/utils/logger.js';
import { exampleService } from '@/services/exampleService.js';

const router = Router();

const createExampleSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  value: z.number().positive('Value must be positive'),
});

/**
 * @swagger
 * /api/v1/example:
 *   post:
 *     summary: Create a new example
 *     tags: [Examples]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               name:
 *                 type: string
 *               value:
 *                 type: number
 *     responses:
 *       201:
 *         description: Example created successfully
 */
router.post('/', async (req, res, next) => {
  try {
    const validated = createExampleSchema.parse(req.body);
    const result = await exampleService.create(validated);
    
    logger.info('Example created', { 
      id: result.id,
      name: validated.name,
    });
    
    res.status(201).json(result);
  } catch (error) {
    next(error);
  }
});

export { router as exampleRoutes };
```

---

## ğŸ§ª Testing KurallarÄ±

### Unit Test YapÄ±sÄ±

```typescript
// âœ… DoÄŸru Test YapÄ±sÄ±
import { describe, it, expect, beforeEach } from 'vitest';
import { userService } from '@/services/userService.js';

describe('userService', () => {
  describe('findById', () => {
    it('should return user when user exists', async () => {
      // Arrange
      const userId = '123';
      
      // Act
      const user = await userService.findById(userId);
      
      // Assert
      expect(user).toBeDefined();
      expect(user?.id).toBe(userId);
    });

    it('should return null when user does not exist', async () => {
      // Arrange
      const userId = 'nonexistent';
      
      // Act
      const user = await userService.findById(userId);
      
      // Assert
      expect(user).toBeNull();
    });
  });
});
```

**Kurallar:**
- âœ… AAA pattern kullanÄ±lmalÄ± (Arrange, Act, Assert)
- âœ… Test naming: `should [expected behavior] when [condition]`
- âœ… Her test case tek bir ÅŸeyi test etmeli
- âœ… Test dosyasÄ± `*.test.ts` formatÄ±nda olmalÄ±

---

## ğŸ”’ Security KurallarÄ±

### Input Validation

```typescript
// âœ… DoÄŸru Validation
import { z } from 'zod';

const createUserSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z.string()
    .min(8, 'Password must be at least 8 characters')
    .regex(/[A-Z]/, 'Password must contain uppercase letter')
    .regex(/[a-z]/, 'Password must contain lowercase letter')
    .regex(/[0-9]/, 'Password must contain number'),
});

export async function createUser(data: unknown) {
  const validated = createUserSchema.parse(data); // Throws if invalid
  // Process validated data
}
```

### SQL Injection Prevention

```typescript
// âœ… DoÄŸru - Drizzle ORM (Type-safe, SQL injection proof)
import { eq } from 'drizzle-orm';

const user = await db.query.users.findFirst({
  where: eq(users.id, userId),
});

// âŒ YANLIÅ - Raw SQL (NEVER DO THIS)
// const user = await db.query(`SELECT * FROM users WHERE id = '${userId}'`);
```

---

## ğŸ“Š Logging KurallarÄ±

### Structured Logging

```typescript
// âœ… DoÄŸru Logging
logger.info('User created', {
  userId: user.id,
  email: user.email,
  timestamp: new Date().toISOString(),
  action: 'create_user',
});

logger.error('Failed to process payment', {
  orderId,
  userId,
  error: error.message,
  stack: error.stack,
  context: { amount, currency },
});

// âŒ YANLIÅ
console.log('User created:', user); // âŒ Never use console.log
console.error('Error:', error);     // âŒ Never use console.error
```

**Kurallar:**
- âœ… Structured logging (JSON format)
- âœ… Context bilgisi eklenmeli
- âœ… Sensitive data log'lanmamalÄ±
- âœ… Log levels: `debug`, `info`, `warn`, `error`

---

## ğŸš€ Performance KurallarÄ±

### Async Operations

```typescript
// âœ… DoÄŸru - Parallel execution
const [users, posts, comments] = await Promise.all([
  getUserById(id),
  getPostsByUserId(id),
  getCommentsByUserId(id),
]);

// âŒ YANLIÅ - Sequential execution
const users = await getUserById(id);      // âŒ Slow
const posts = await getPostsByUserId(id); // âŒ Slow
const comments = await getCommentsByUserId(id); // âŒ Slow
```

### Database Optimization

```typescript
// âœ… DoÄŸru - Select only needed fields
const projects = await db.query.seoProjects.findMany({
  where: eq(seoProjects.status, 'active'),
  columns: {
    id: true,
    name: true,
    domain: true,
  },
  limit: 100,
});

// âŒ YANLIÅ - Select all fields
const projects = await db.query.seoProjects.findMany(); // âŒ Too much data
```

---

## ğŸ—‚ï¸ Dosya Organizasyonu KurallarÄ±

```
src/
â”œâ”€â”€ config/          # Configuration files
â”‚   â””â”€â”€ index.ts     # Main config export
â”œâ”€â”€ db/              # Database
â”‚   â”œâ”€â”€ index.ts     # DB connection
â”‚   â””â”€â”€ schema.ts    # Drizzle schema
â”œâ”€â”€ middleware/      # Express middleware
â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â”œâ”€â”€ requestLogger.ts
â”‚   â””â”€â”€ prometheus.ts
â”œâ”€â”€ routes/          # API routes
â”‚   â”œâ”€â”€ index.ts     # Route setup
â”‚   â”œâ”€â”€ health.ts
â”‚   â”œâ”€â”€ seo.ts
â”‚   â””â”€â”€ content.ts
â”œâ”€â”€ services/        # Business logic
â”‚   â”œâ”€â”€ seoAnalyzer.ts
â”‚   â””â”€â”€ contentGenerator.ts
â”œâ”€â”€ schemas/         # Zod validation
â”‚   â””â”€â”€ feedback.ts
â””â”€â”€ utils/           # Utilities
    â”œâ”€â”€ logger.ts
    â””â”€â”€ gracefulShutdown.ts
```

**Kurallar:**
- âœ… Her klasÃ¶rÃ¼n tek bir sorumluluÄŸu olmalÄ±
- âœ… Services â†’ Business logic
- âœ… Routes â†’ HTTP handlers
- âœ… Middleware â†’ Cross-cutting concerns
- âœ… Utils â†’ Reusable helpers

---

## âœ… YAPILMASI GEREKENLER

### TypeScript

- âœ… Her zaman explicit types kullanÄ±n
- âœ… Null safety iÃ§in null checks yapÄ±n
- âœ… Path aliases (`@/`) kullanÄ±n
- âœ… File extensions ekleyin (`.js`)
- âœ… Generic types'Ä± uygun yerlerde kullanÄ±n

### Error Handling

- âœ… Her async fonksiyon iÃ§in try-catch
- âœ… Ã–zel error class'larÄ± kullanÄ±n
- âœ… Error'larÄ± log'layÄ±n
- âœ… User-friendly messages, detaylarÄ± log'da

### Validation

- âœ… Zod schemas kullanÄ±n
- âœ… API endpoints'de validation
- âœ… Drizzle ORM kullanÄ±n (SQL injection korumasÄ±)

### Logging

- âœ… Structured logging (logger utility)
- âœ… Context bilgisi ekleyin
- âœ… Sensitive data log'lamayÄ±n

### Testing

- âœ… Her feature iÃ§in unit test
- âœ… Test coverage %70+ (hedef %80+)
- âœ… Integration testler iÃ§in testcontainers
- âœ… AAA pattern kullanÄ±n

---

## âŒ YAPILMAMASI GEREKENLER

1. âŒ **`any` type kullanmayÄ±n** - Her zaman explicit types
2. âŒ **`console.log` kullanmayÄ±n** - Logger utility kullanÄ±n
3. âŒ **Raw SQL queries** - Drizzle ORM kullanÄ±n
4. âŒ **Hardcoded secrets** - Environment variables
5. âŒ **Main branch'e direkt commit** - PR aÃ§Ä±n
6. âŒ **BÃ¼yÃ¼k PR'lar** (1000+ satÄ±r) - KÃ¼Ã§Ã¼k, odaklanmÄ±ÅŸ PR'lar
7. âŒ **Test yazmadan PR** - Her feature iÃ§in test
8. âŒ **Relative imports** (`../../`) - Path aliases kullanÄ±n
9. âŒ **Synchronous DB operations** - async/await kullanÄ±n
10. âŒ **Unhandled promises** - Her zaman handle edin

---

## ğŸ” Kod Review Checklist

PR aÃ§madan Ã¶nce kontrol edin:

- [ ] TypeScript types tanÄ±mlÄ± (no `any`)
- [ ] Linting geÃ§iyor (`pnpm lint`)
- [ ] Tests geÃ§iyor (`pnpm test`)
- [ ] Test coverage %70+ (`pnpm test:coverage`)
- [ ] Error handling var (try-catch)
- [ ] Input validation yapÄ±ldÄ± (Zod)
- [ ] Logging eklendi (logger, not console)
- [ ] DokÃ¼mantasyon gÃ¼ncellendi (README, JSDoc)
- [ ] Security kontrolÃ¼ yapÄ±ldÄ±
- [ ] No hardcoded secrets
- [ ] Path aliases kullanÄ±ldÄ± (`@/`)
- [ ] Drizzle ORM kullanÄ±ldÄ± (no raw SQL)

---

## ğŸ“š Referans DokÃ¼mantasyon

- **[CODING_STANDARDS.md](./CODING_STANDARDS.md)** - DetaylÄ± kod standartlarÄ±
- **[CONTRIBUTING.md](./CONTRIBUTING.md)** - KatkÄ±da bulunma rehberi
- **[README.md](./README.md)** - Proje dokÃ¼mantasyonu
- **[PROJE_KONTROL_RAPORU.md](./PROJE_KONTROL_RAPORU.md)** - Proje kontrol raporu

---

## ğŸ”„ GÃ¼ncelleme NotlarÄ±

### v5.0.0 (2025-01-27)
- âœ… Ä°lk kapsamlÄ± `.cursorrules` versiyonu
- âœ… AI asistanÄ± direktifleri eklendi
- âœ… Dosya/glob bazlÄ± kurallar tanÄ±mlandÄ±
- âœ… Ã–rnek kod bloklarÄ± geniÅŸletildi
- âœ… Frontend ve Backend ayrÄ± bÃ¶lÃ¼mler olarak dÃ¼zenlendi

---

**Son GÃ¼ncelleme:** 2025-01-27  
**Versiyon:** 5.0.0  
**GeÃ§erlilik:** Dese EA Plan v5.0+
