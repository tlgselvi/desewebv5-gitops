# DESE EA PLAN v7.1 — Enterprise Ruleset

## 1. Mimari Prensipler (Architecture First)
- **Modular Monolith:** Kod tabanı `src/modules/{module_name}` altında ayrıştırılmalıdır.
- **DDD (Domain Driven Design):** İş mantığı servislerde (`service.ts`), veri erişimi repolarda olmalıdır.
- **Multi-tenancy:** Her veritabanı sorgusu `organization_id` kontrolü içermelidir.
- **Relaxed Typing:** TypeScript strict mode KAPALI. IDE linting'e güvenin, runtime hatalarını test ile yakalayın.

## 2. Teknoloji Standartları (Tech Stack)
- **Frontend:** Next.js 16 (App Router), React 19, Tailwind CSS v4.
- **Backend:** Node.js 20, Express, Drizzle ORM (PostgreSQL).
- **AI & Botlar:** MCP (Model Context Protocol) sunucuları `src/mcp` altında tutulur.
- **State Management:** Zustand (Global), React Query (Server State).
- **Runtime:** TSX transpilation (build-time TSC yerine).

## 3. Docker Konfigürasyonu
- **Start Command:** `tsx src/index.ts` (TSX runtime transpilation)
- **Build:** TypeScript derlemesi atlanır, runtime transpilation kullanılır
- **Servisler:**
  - Backend API: Port 3000
  - Frontend: Port 3002
  - PostgreSQL: Port 5432
  - Redis: Port 6379
  - Mosquitto MQTT: Port 1883, 9001
  - Prometheus: Port 9090
  - Grafana: Port 3003

## 4. Geliştirme Kuralları (Coding Standards)
- **Hybrid Dev Mode:** Altyapı Docker'da (`docker compose up -d db redis mosquitto`), Uygulama lokalde (`pnpm dev`).
- **Full Docker Mode:** `docker compose up -d --build`
- **Schema Changes:** `src/db/schema` klasöründe modüler dosyalarda yapılır.
- **Error Handling:** Tüm async işlemler `try/catch` veya `asyncHandler` ile sarılır.
- **Logging:** `console.log` yerine yapılandırılmış `logger` kullanılır.
- **Drizzle Queries:** `db.query.*` yerine `db.select().from()` formatını tercih edin.

## 5. TypeScript Notları
- **Strict Mode:** KAPALI (`strict: false`, `noImplicitAny: false`, `strictNullChecks: false`)
- **Router Types:** Express router'lara `const router: ExpressRouter = Router();` şeklinde tip ekleyin.
- **Tip Kontrolü:** Manuel kontrol için `pnpm typecheck` kullanın.

## 6. Payment Entegrasyonları
- **Stripe:** `STRIPE_SECRET_KEY`, `STRIPE_PUBLISHABLE_KEY`
- **PayPal:** `PAYPAL_CLIENT_ID`, `PAYPAL_CLIENT_SECRET`, `PAYPAL_MODE`
- **iyzico:** `IYZICO_API_KEY`, `IYZICO_SECRET_KEY`, `IYZICO_BASE_URL`

## 7. Dokümantasyon & Dil
- **Dil:** Kod yorumları ve commit mesajları İngilizce, UI metinleri Türkçe olabilir.
- **JSDoc:** Her yeni fonksiyon ve component için kısa bir açıklama eklenir.
- **Ana Dokümanlar:**
  - `DESE_EA_PLAN_TRANSFORMATION_REPORT.md` - Ana plan
  - `docs/DOCKER_QUICKSTART.md` - Docker kılavuzu
  - `docs/CHANGELOG.md` - Değişiklik günlüğü

## 8. Güvenlik (Security)
- Asla `.env` dosyasını commitleme.
- Kullanıcı verilerini (PII) loglama.
- Her API endpoint'i `authMiddleware` ile korunmalıdır.
- Rate limiting aktif: `src/config/rate-limit.config.ts`

## 9. Bellek ve Odak (Memory & Focus)
- **Eski Versiyonlar:** v6.x ve öncesi "Legacy" olarak kabul edilir. Sadece referans içindir.
- **Odak:** v7.1.0 - Production-ready Enterprise SaaS Platform.
- **Hedef:** SaaS, ERP, CRM ve IoT özelliklerini entegre etmek.
- **Durum:** %100 TAMAMLANDI (22/22 TODO)

## 10. Hızlı Komutlar
```bash
# Development
docker compose up -d db redis mosquitto  # Altyapı
pnpm dev                                  # Backend
cd frontend && pnpm dev                   # Frontend

# Production
docker compose up -d --build              # Tümü Docker'da

# Health Check
curl http://localhost:3000/health

# Logs
docker logs -f desewebv5-app-1
```
